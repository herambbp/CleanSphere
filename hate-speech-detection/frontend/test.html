<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Dashboard Refresh Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-card {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        h1 {
            margin-top: 0;
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-weight: bold;
        }
        .status.good {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        .status.bad {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        .info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        #timer {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        #loadCount {
            font-size: 32px;
            font-weight: bold;
            color: #764ba2;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="test-card">
        <h1>üîç Dashboard Refresh Diagnostic Test</h1>
        
        <div class="info">
            <strong>Purpose:</strong> This test page helps identify if the refresh issue is caused by your browser/environment or the dashboard code.
        </div>

        <h2>Test Results:</h2>
        
        <div class="status" id="statusBox">
            <p>Testing... Please wait 5 seconds.</p>
        </div>

        <h3>Statistics:</h3>
        <p><strong>Page Load Count:</strong> <span id="loadCount">1</span></p>
        <p><strong>Time Since Last Load:</strong> <span id="timer">0</span> seconds</p>
        <p><strong>Page Loaded At:</strong> <span id="loadTime"></span></p>
        <p><strong>Previous Load Time:</strong> <span id="prevLoadTime">None (first load)</span></p>

        <div class="info" style="margin-top: 30px;">
            <h3>üìã How to Interpret Results:</h3>
            <ul>
                <li><strong>Load Count = 1:</strong> ‚úÖ Good! No auto-refresh detected.</li>
                <li><strong>Load Count > 1 in first 5 seconds:</strong> ‚ùå Auto-refresh is happening!</li>
                <li><strong>Timer increasing normally:</strong> ‚úÖ Good! Page is stable.</li>
                <li><strong>Timer resetting to 0:</strong> ‚ùå Page is refreshing!</li>
            </ul>
        </div>

        <div class="info">
            <h3>üéØ Next Steps:</h3>
            <p id="nextSteps">Observing page behavior...</p>
        </div>

        <div class="info">
            <h3>üîç Browser Console Check:</h3>
            <p>Open your browser console (F12) and check for:</p>
            <ul>
                <li>Red error messages</li>
                <li>Repeated "Page loaded" messages</li>
                <li>Any warnings about reloading</li>
            </ul>
        </div>
    </div>

    <script>
        // Track load count using localStorage
        let loadCount = parseInt(localStorage.getItem('testLoadCount') || '0') + 1;
        localStorage.setItem('testLoadCount', loadCount);
        
        // Track last load time
        const now = new Date();
        const prevTime = localStorage.getItem('testLastLoad');
        const currentTime = now.toISOString();
        
        document.getElementById('loadCount').textContent = loadCount;
        document.getElementById('loadTime').textContent = currentTime;
        
        if (prevTime) {
            document.getElementById('prevLoadTime').textContent = prevTime;
            
            const prev = new Date(prevTime);
            const diffSeconds = (now - prev) / 1000;
            
            if (diffSeconds < 5) {
                console.error('‚ö†Ô∏è RAPID RELOAD DETECTED! Time since last load:', diffSeconds, 'seconds');
            }
        }
        
        localStorage.setItem('testLastLoad', currentTime);
        
        // Log to console
        console.log('='.repeat(60));
        console.log('üìä DIAGNOSTIC TEST PAGE LOADED');
        console.log('='.repeat(60));
        console.log('Load Count:', loadCount);
        console.log('Current Time:', currentTime);
        console.log('Previous Load:', prevTime || 'First load');
        console.log('='.repeat(60));
        
        // Timer to show elapsed time
        let seconds = 0;
        const timerInterval = setInterval(() => {
            seconds++;
            document.getElementById('timer').textContent = seconds;
        }, 1000);
        
        // Monitor for unexpected reloads
        window.addEventListener('beforeunload', function(e) {
            console.warn('‚ö†Ô∏è Page is being unloaded/refreshed!');
            console.trace();
        });
        
        // Check after 5 seconds
        setTimeout(() => {
            const statusBox = document.getElementById('statusBox');
            const nextSteps = document.getElementById('nextSteps');
            
            if (loadCount === 1) {
                statusBox.className = 'status good';
                statusBox.innerHTML = `
                    <p>‚úÖ <strong>PASS:</strong> No auto-refresh detected!</p>
                    <p>Your browser and environment are working correctly.</p>
                `;
                nextSteps.innerHTML = `
                    <strong>The issue is likely in the dashboard code.</strong><br>
                    ‚úÖ Your browser/environment is NOT causing the refresh.<br>
                    üìã Next: Check the REFRESH_ISSUE_FIX.md guide for code-specific solutions.
                `;
            } else if (loadCount === 2) {
                statusBox.className = 'status bad';
                statusBox.innerHTML = `
                    <p>‚ö†Ô∏è <strong>WARNING:</strong> Page loaded twice!</p>
                    <p>This might indicate a refresh issue.</p>
                `;
                nextSteps.innerHTML = `
                    <strong>Possible causes:</strong><br>
                    1. You manually refreshed during the test<br>
                    2. Browser extension is causing reload<br>
                    3. Development server auto-reload<br><br>
                    üìã Check: REFRESH_ISSUE_FIX.md for solutions.
                `;
            } else {
                statusBox.className = 'status bad';
                statusBox.innerHTML = `
                    <p>‚ùå <strong>FAIL:</strong> Multiple reloads detected! (${loadCount} loads)</p>
                    <p>Your browser/environment is causing auto-refresh.</p>
                `;
                nextSteps.innerHTML = `
                    <strong>ACTION REQUIRED:</strong><br>
                    1. ‚ùå Disable ALL browser extensions<br>
                    2. ‚ùå Close any development servers<br>
                    3. ‚ùå Stop VS Code Live Server<br>
                    4. ‚úÖ Open this file directly (not via server)<br>
                    5. ‚úÖ Try incognito/private browsing mode<br><br>
                    üìã Full guide: REFRESH_ISSUE_FIX.md
                `;
            }
        }, 5000);
        
        // Clear test data button
        const clearBtn = document.createElement('button');
        clearBtn.textContent = 'üîÑ Reset Test (Clear Data)';
        clearBtn.style.cssText = 'padding: 10px 20px; margin-top: 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;';
        clearBtn.onclick = function() {
            localStorage.removeItem('testLoadCount');
            localStorage.removeItem('testLastLoad');
            alert('Test data cleared! Reload the page to start fresh.');
            location.reload();
        };
        document.querySelector('.test-card').appendChild(clearBtn);
    </script>
</body>
</html>