<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Hate Speech Detection Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Main Container -->
    <div class="container">
      <!-- Header -->
      <header class="header">
        <div class="header-content">
          <span class="material-icons header-icon">shield</span>
          <h1>CleanSphere</h1>
          <span class="version-badge">with Intelligent AI Verification</span>
        </div>
        <div class="header-actions">
          <button class="icon-button" id="searchBtn" title="Search">
            <span class="material-icons">search</span>
          </button>
          <button
            class="icon-button"
            id="notificationBtn"
            title="Notifications"
          >
            <span class="material-icons">notifications</span>
          </button>
          <button
            class="icon-button theme-toggle"
            id="themeToggle"
            title="Toggle Theme"
          >
            <span class="material-icons">dark_mode</span>
          </button>
          <div class="user-avatar">
            <span class="material-icons">account_circle</span>
          </div>
        </div>
      </header>
      <!-- Navigation Tabs -->
    <div class="tabs">
      <button class="tab-button active" data-tab="csv">
        CSV Upload & Dashboard
      </button>
      <button class="tab-button" data-tab="message">
        Single Message Testing
      </button>
    </div>

      <!-- CSV Upload & Dashboard Section -->
      <div id="csvTab" class="tab-content active">
        <!-- Upload Section -->
        <div class="card upload-card" id="uploadSection">
          <div class="upload-area" id="uploadArea">
            <span class="material-icons upload-icon">cloud_upload</span>
            <h3>Drag and drop your .csv file here or click to upload.</h3>
            <p class="upload-hint">
              Expected CSV format: <code>name</code>, <code>timestamp</code>,
              <code>comment</code>
            </p>
            <input type="file" id="fileInput" accept=".csv" hidden />

            <button
              class="btn btn-primary"
              onclick="document.getElementById('fileInput').click()"
            >
              <span class="material-icons">upload_file</span>
              Upload CSV
            </button>
          </div>

          <!-- Loading State -->
          <div class="loading-state" id="loadingState">
            <div class="spinner"></div>
            <p>Processing CSV file... This may take a few moments.</p>
          </div>
        </div>

        <!-- Intelligent Mode Checkbox for CSV -->
            <div class="intelligent-mode-checkbox">
              <label class="checkbox-label">
                <input type="checkbox" id="csvIntelligentMode" />
                <span class="checkbox-text">
                  <span class="material-icons">psychology</span>
                  Enable Intelligent Mode
                </span>
              </label>
              <p class="checkbox-hint">When enabled, we will verify a sample of high-risk comments and provide feedback</p>
            </div>


        <!-- Dashboard Section -->
        <div
          id="dashboardSection"
          class="dashboard-section"
          style="display: none"
        >
          <!-- Summary Stats -->
          <div class="stats-grid" id="statsGrid">
            <!-- Stats will be populated dynamically -->
          </div>

          <!-- Charts Section -->
          <div class="charts-section">
            <div class="card chart-card">
              <h3>Classification Distribution</h3>
              <canvas id="classificationChart"></canvas>
            </div>

            <div class="card chart-card">
              <h3>User Risk Levels</h3>
              <canvas id="riskLevelsChart"></canvas>
            </div>
          </div>

          <div class="card chart-card full-width">
            <h3>Severity Scores Over Time</h3>
            <canvas id="severityTimeChart"></canvas>
          </div>

          <!-- Top Risk Users Table -->
          <div class="card table-card">
            <div class="table-header">
              <h3>Top Risk Users</h3>
              <div class="table-actions">
                <button class="btn btn-secondary" id="filterBtn">
                  <span class="material-icons">filter_list</span>
                  Filter
                </button>
                <button class="btn btn-success" id="exportBtn">
                  <span class="material-icons">download</span>
                  Export
                </button>
              </div>
            </div>

            <!-- Filter Section -->
            <div
              class="filter-section"
              id="filterSection"
              style="display: none"
            >
              <input
                type="text"
                id="searchUser"
                class="filter-input"
                placeholder="Search users..."
              />
              <select id="filterRisk" class="filter-select">
                <option value="">All Risk Levels</option>
                <option value="CRITICAL">Critical</option>
                <option value="HIGH">High</option>
                <option value="MEDIUM">Medium</option>
                <option value="LOW">Low</option>
                <option value="MINIMAL">Minimal</option>
              </select>
            </div>

            <div class="table-container" id="userTableContainer">
              <!-- Table will be populated dynamically -->
            </div>
          </div>
        </div>
      </div>

      <!-- Single Message Testing Section -->
      <div id="messageTab" class="tab-content">
        <div class="card analysis-card">
          <h2>Real-Time Analysis</h2>
          <p class="subtitle">
            Enter text to analyze for hate speech and toxicity.
          </p>

          <div class="message-input-section">
            <label for="messageInput">Message</label>
            <textarea
              id="messageInput"
              class="message-textarea"
              placeholder="Enter text to analyze..."
              maxlength="5000"
            ></textarea>
            <div class="textarea-footer">
              <span class="char-count" id="charCount">0/5000 characters</span>

              <!-- Intelligent Mode Checkbox for Single Message -->
              <label class="checkbox-label intelligent-inline">
                <input type="checkbox" id="intelligentMode" />
                <span class="checkbox-text">
                  <span class="material-icons">psychology</span>
                  Intelligent Mode
                </span>
              </label>

              <button class="btn btn-primary" id="analyzeBtn">
                <span class="material-icons">analytics</span>
                Analyze
              </button>
            </div>
          </div>

          <!-- Loading State -->
          <div
            class="loading-state"
            id="messageLoadingState"
            style="display: none"
          >
            <div class="spinner"></div>
            <p>Analyzing message...</p>
          </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" style="display: none">
          <div class="card results-card">
            <h2>Results</h2>

            <div class="results-grid">
              <div class="result-item">
                <span class="result-label">Prediction:</span>
                <span class="badge" id="predictionBadge"></span>
              </div>
              <div class="result-item">
                <span class="result-label">Urgency:</span>
                <span class="badge" id="urgencyBadge"></span>
              </div>
            </div>

            <div class="confidence-section">
              <div class="confidence-header">
                <span class="result-label">Confidence</span>
                <span class="confidence-value" id="confidenceValue">0%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="confidenceBar"></div>
              </div>
            </div>

            <div class="severity-section">
              <span class="result-label">Severity:</span>
              <span id="severityText">Low (1/10)</span>
            </div>

            <div class="action-section">
              <h4>Recommended Action:</h4>
              <p id="actionText">No action required.</p>
            </div>

            <!-- NEW: Verification Section -->
            <div
              class="verification-section"
              id="verificationSection"
              style="display: none"
            >
              <div id="verificationDetails">
                <!-- Verification details will be populated dynamically -->
              </div>
            </div>

            <div class="explanation-section">
              <button class="explanation-toggle" id="explanationToggle">
                <span>View Explanation</span>
                <span class="material-icons">expand_more</span>
              </button>
              <div
                class="explanation-content"
                id="explanationContent"
                style="display: none"
              >
                <h4>Analysis Details</h4>
                <div id="explanationDetails">
                  <!-- Explanation details will be populated dynamically -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Export Data</h3>
          <button class="modal-close" id="closeModal">
            <span class="material-icons">close</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Choose export format:</p>
          <button class="btn btn-primary full-width" id="exportCSV">
            <span class="material-icons">description</span>
            Export as CSV
          </button>
          <button class="btn btn-primary full-width" id="exportJSON">
            <span class="material-icons">code</span>
            Export as JSON
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
      <span id="toastMessage"></span>
    </div>

    <script src="script.js"></script>
  </body>
</html>
